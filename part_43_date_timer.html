<!DOCTYPE html>
<html>
<head>
	<title>Frontend. Заняття 43. Робота з датою і часом, таймери.</title>
	<meta charset="utf-8">
	<meta name="keywords" content="">
	<meta name="description" content="">
	<meta name="format-detection" content="telephone=no">
	<link type="text/css" rel="stylesheet" href="css/styles.css">
</head>
<body>
<div id="mainwrapper">
	<div class="resize">

		<h1>Робота з датою і часом, таймери.</h1>

		<section>
			<h2>Формат дати/часу.</h2>
			<p>Для роботи з датою та часом у JS є об’єкт Date.</p>
			<p>Створити змінну з датою і часом можна таким чином:</p>
			<code>
				// створити змінну дати з поточним часом:<br>
				<strong>var date = new Date();</strong><br><br>
				// встановити дату з заданним значенням у мілісекундах з 1 січня 1970 року:<br>
				<strong>date = new Date(dateVal);</strong><br><br>
				// встановити дату з заданими значеннями компонентів дати:<br>
				<strong>date = new Date(year, month, date[, hours, minutes, seconds, ms] );</strong><br>
				date = new Date(2015, 0, 1, 12, 0, 0);<br><br>
				// встановити дату з заданими значеннями у вигляді строки:<br>
				<strong>date = new Date('21 May 1958 10:12');</strong>
			</code>
			<p>Якщо вивести значення цієї змінної у консоль, побачимо щось схоже на:</p>
			<code>
				Sun Feb 01 2015 12:00:00 GMT+0200 (Финляндия (зима))
			</code>
			<p>У дати є ще один формат: число - кількість мілісекунд, що пройшли з 1 січня 1970 року:</p>
			<code>
				// встановити дату у числовому форматі з поточним часом:<br>
				<strong>date = Date.now();</strong><br><br>
				//добавити до дати 1 день<br>
				date = date + (24 * 60 * 60 * 1000);<br>
				date = date + (24 * 3600 * 1000);<br>
				date = date + (86400000); &nbsp;&nbsp; // незрозуміле, "<a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D1%87%D0%B8%D1%81%D0%BB%D0%BE_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)" target="_blank">магічне</a>" число
			</code>
			<h3>Завдання.</h3>
			<ol>
				<li>Створіть кнопку.</li>
				<li>Виводьте в консоль час в мілісекундах, що проходить між двома кліками по кнопці.</li>
				<li>Виведіть повідомлення що показує дату та час, які настануть через два тижня, 6 годин і 20 хвилин від теперішнього.</li>
			</ol>
		</section>

		<section>
			<h2>Методи для роботи з датою/часом.</h2>
			<p>Об’єкт Date має багато методів для обробки даних, які він містить.</p>
			<p>Для початку давайте розберемося з деякими особливостями в компонентах дати.</p>
			<p>
				<strong>Нумерація місяців</strong> починається з нуля:<br>
				0 - січень;<br>
				1 - лютий;<br>
				2 - березень;<br>
				...<br>
				10 - листопад;<br>
				11 - грудень.
			</p>
			<p>
				<strong>Нумерація днів тижня</strong> починається з нуля і неділі:<br>
				0 - неділя;<br>
				1 - понеділок;<br>
				...<br>
				5 - п'ятниця;<br>
				6 - шабат.
			</p>
			<p>Дні місяця починаються з 1 і до 31.</p>
			<p>Години: 0..23.</p>
			<p>Хвилини та секунди: 0..59 (<a href="https://uk.wikipedia.org/wiki/%D0%92%D0%B8%D1%81%D0%BE%D0%BA%D0%BE%D1%81%D0%BD%D0%B0_%D1%81%D0%B5%D0%BA%D1%83%D0%BD%D0%B4%D0%B0" target="_blank">високосна секунда</a>, не підтримується у JS).</p>
			<p>Мілісекунди: 0..999.</p>
			<p>Основні методи (весь список методів на <a href="http://javascript.ru/Date" target="_blank">http://javascript.ru/Date</a>):</p>
			<code>
				// розпарсити строку в дату:<br>
				date = <strong>Date.parse("10-24-2015, 06:34");</strong><br><br>
				// перетворити дату в строку (числовий формат перетвориться в строку-число):<br>
				<strong>date.toString();</strong><br><br>
				// перетворити об'єкт дати в число:<br>
				<strong>date.valueOf();</strong><br>
				alert(new Date(2017, 0, 1).valueOf());
			</code>
			<p>Робота з компонентами дати:</p>
			<code>
				// повертають компоненти дати:<br>
				date.getFullYear();<br>
				date.getMonth();<br>
				date.getDate();<br>
				date.getDay(); &nbsp;&nbsp; // повертає день тижня<br>
				date.getHours();<br>
				date.getMinutes();<br>
				date.getSeconds();<br>
				date.getMilliseconds();<br><br>
				// встановлює нове значення компонента дати:<br>
				date.setFullYear(x);<br>
				date.setMonth(x);<br>
				date.setDate(x);<br>
				date.setHours(x);<br>
				date.setMinutes(x);<br>
				date.setSeconds(x);<br>
				date.setMilliseconds(x);
			</code>
			<p>Метода setDay() немає, тому що день тижня - це обчислювана величина.</p>
			<p>date.getYear() - метод, що не рекомендується використовувати. Він працював до 2000 року і повертав останні дві цифри року: 96, 98, 99. Зараз він повертає 116, 117...</p>
			<p>Робота з методами, що працюють з таймзонами, UTC-часом, представленням часу в локальному форматі вам знадобляться при роботі з крупними мультимовними сайтами, що працюють одночасно в багатьох часових поясах. Нічого складного в цих методах немає, розібратися в них зможете самі, головне - правильно побудувати логіку алгоритму.</p>
			<p>Об'єкт часу є автокориговочним. Це означає, що ви не зможете встановити дату 29 лютого у невисокосний рік, дата автоматично встановиться на 1 березня.</p>
			<p>Якщо в один з компонентів встановити значення більше, ніж допустиме - автоматично виникне зсув на наступні дати, години і т.д.</p>
			<h3>Завдання.</h3>
			<ol>
				<li>Виведіть повідомлення з номером поточного дня тижня.</li>
				<li>Виведіть повідомлення з назвою поточного дня тижня.</li>
				<li>Виведіть повідомлення з датою, що була 100 днів тому.</li>
				<li>Створіть функцію, що повертає задану їй дату в форматі "дд/мм/рр" (24/05/17). Виведіть повідомлення з завтрашньою датою в цьому форматі.</li>
			</ol>
		</section>

		<section>
			<h2>Таймери.</h2>
			<p>Таймер - це затримка виконання функції на вказаний час.</p>
			<p>JavaScript підтримує роботу з двома типами таймерів - одноразовим setTimeout() та багаторазовим setInterval().</p>
			<p>Кожна з цих функцій приймає в себе щонайменше 2 аргумента: функцію, що має виконатися, і час в мілісекундах:</p>
			<code>
				var i = 5;<br>
				function fun(){ console.log(i++); }<br>
				setTimeout(function(){ console.log('hello!'); }, 5000);<br>
				setInterval(fun, 1000);
			</code>
			<p>Якщо у функцію треба передати аргументи - вони прописуються в кінець, після часу затримки:</p>
			<code>
				setTimeout(function(a, b, c) { console.log(a + b + c); }, 3000, 5, 10, 20);<br>
				function fun(k){ console.log(k); }<br>
				setInterval(fun, 1000, 'hello');
			</code>
			<p>Таймер можна зупинити, вимкнути. Кожна з вищевказаних функцій повертає ідентифікатор таймера (число), зупинити можна двома функціями:</p>
			<code>
				var a = setTimeout(fun, 5000);<br>
				var b = setInterval(fun, 8000);<br>
				button.onclick = function(){<br>
				&nbsp;&nbsp;clearTimeout(a);<br>
				&nbsp;&nbsp;clearInterval(b);<br>
				}
			</code>
			<p>Функції таймерів є асинхронними, тобто - вони можуть виконуватися паралельно з виконанням іншого коду. Про це треба пам'ятати і бути обережним.</p>
			<p>Розглянемо приклади:</p>
			<code>
				// що відобразить alert?<br>
				var x = 5;<br>
				setTimeout(function(){ alert(x); }, 100);<br>
				x = 10;<br><br>
				// хочемо вивести в консоль текст перших 5-и абзаців:<br>
				var p = document.querySelectorAll('p');<br>
				for (var i = 0; i < 5; i++){<br>
				&nbsp;&nbsp;setTimeout(function(){ console.log(p[i].innerText); }, (i + 1) * 1000);<br>
				}
			</code>
			<p>Останній варіант має декілька варіантів правильного розв'язку:</p>
			<code>
				// використаємо let замість var:<br>
				var p = document.querySelectorAll('p');<br>
				for (let i = 0; i < 5; i++){<br>
				&nbsp;&nbsp;setTimeout(function(){ console.log(p[i].innerText); }, (i + 1) * 1000);<br>
				}<br><br>
				// передамо у функцію потрібний абзац у якості аргумента:<br>
				var p = document.querySelectorAll('p');<br>
				for (var i = 0; i < 5; i++){<br>
				&nbsp;&nbsp;setTimeout(function(e){ console.log(e.innerText); }, (i + 1) * 1000, p[i]);<br>
				}<br><br>
				// можна використати метод forEach, з ним також код буде працювати вірно. Спробуйте самі.
			</code>
		</section>

		<section class="homework">
			<h2>Домашнє завдання.</h2>
			<ol>
				<li>
					На наступне заняття підготуйте новий проект: файли html, css, js.<br>
					В html-файлі створіть декілька полів ввода з класом "js-date", пару span-кнопок:<br>
					<code>
						&lt;p&gt;<br>
						&nbsp;&nbsp;&lt;time id="date1"&gt;дд.мм.рррр&lt;/time&gt;<br>
						&nbsp;&nbsp;&lt;span class="js-date" data-for="date1"&gt;Вибрати дату&lt;/span&gt;<br>
						&lt;/p&gt;
					</code>
					Оформіть створені елементи стилями на свій смак.<br>
					Створіть div#datepicker з табличкою довільного місяця і заголовком, щось на зразок цього (але український варіант):<br>
					<img src="images/datepicker.png" alt="Datepicker"><br>
					Наступні завдання виконуйте у пісочниці чи проекті по домашньому завданню №43.
				</li>
				<li>Через 5 секунд після відкриття сторінки вивести на екран повідомлення "5 seconds!".</li>
				<li>Зробити таймер, що починає відлік з 3:30, рахує посекундно у зворотньому напрямку і після досягнення значення 0:00 замість цифр видає текст "BOOM!!!" <em>(прим.: тероризм - це погано)</em>.</li>
				<li>
					Зробити годинник, що відображає в браузері поточні дату та час - день, місяць, рік, день тижня, години, хвилини, секунди. Синхронізацію проводити 1 раз на 5 хвилин.<br>
					Рекомендації до виконання: раціонально створити масив змінних [Y, M, D, d, h, m, s] та 3 функції: синхронізацію з годинником комп’ютера; функцію, що повертає оформлену строку з датою та часом та функцію, яка буде робити розрахунки додавання секунди та перевірки хвилин, годин і т.п. на перевищення допустимих значень. В таймері setInterval потрібно зробити додавання секунди, виведення строки та 1 раз на 300 циклів проводити синхронізацію.<br>
					Зауваження. Можна щосекунди брати системний час та виводити його вбудованими функціями, типу .toString(), .toLocaleString() і т.п., але перед нами стоїть задача навчитися оперувати складовими дати та часу.
				</li>
			</ol>
			<p>Корисні посилання:</p>
			<p><a href="https://habrahabr.ru/post/146109/" target="_blank">Заблуждения программистов относительно времени</a>.</p>
			<p><a href="https://habrahabr.ru/post/242459/" target="_blank">Проблемы даты и времени в JS</a>.</p>
		</section>
	</div>
</div>

</body>
</html>